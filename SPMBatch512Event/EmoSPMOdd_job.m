%-----------------------------------------------------------------------
% Job saved on 02-Oct-2019 17:59:16 by cfg_util (rev $Rev: 7345 $)
% spm SPM - SPM12 (7487)
% cfg_basicio BasicIO - Unknown
% Modified by Yuchao Wang 11/8/2019
%-----------------------------------------------------------------------

rootDir = '/Users/yuchaow/Documents/narrativefMRIdata';

%%Prep output directory 
for i = 1:60 
    spm_mkdir([rootDir '/S' num2str(i, '%02.f') '/SPMemoOutputs512Event']);
end

%%BATCH RUN
for i = 1:60 
    outDirSPM = [rootDir '/S' num2str(i, '%02.f') '/SPMemoOutputs512Event'];
    inDirNII = [rootDir '/S' num2str(i, '%02.f') '/session1'];
     if mod(i,2) == 0 
         continue 
     elseif ~exist(inDirNII, 'dir') 
         ['OOPS, NO NIFTI FILES FOR SUBJECT #' num2str(i)]
         continue
     else
         
matlabbatch{1}.spm.stats.fmri_spec.dir = {outDirSPM};
matlabbatch{1}.spm.stats.fmri_spec.timing.units = 'secs';
matlabbatch{1}.spm.stats.fmri_spec.timing.RT = 0.88;
matlabbatch{1}.spm.stats.fmri_spec.timing.fmri_t = 16;
matlabbatch{1}.spm.stats.fmri_spec.timing.fmri_t0 = 8;
%%
DHniiList = spm_select('FPList', [inDirNII '/MH1st_run1/'], '\.nii*');
sess1_scans = spm_select('Expand', DHniiList);
matlabbatch{1}.spm.stats.fmri_spec.sess(1).scans = cellstr(sess1_scans);
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.name = 'DHOG';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.onset = [4.037728319
6.338240407
10.83987368
12.83526059
16.45444553
22.40762933
26.68501024
31.60720976
36.07712227
39.51779434
44.11374271
46.07280089
47.56549957
49.65140878
53.615253
55.43948331
57.50747283
59.11485115
61.11433476
63.43394004
66.28046704
71.90547109
77.14669448
78.17951026
82.29856907
85.03551237
87.22121357
88.65574091
90.61441837
92.35222308
96.87198276
99.91918078
105.4620519
107.8614212
110.1335482
116.3370599
123.0157226
128.9718236
131.6067039
134.9000294
137.1825017
139.5431736
142.9001582
144.7936335
146.3829186
151.5304671
154.3550425
156.4181853
161.8583409
166.1565755
167.4824432
170.900055
175.3289007
176.725013
178.4964732
182.9296982
184.4300799
186.1413471
188.1233109
190.4521531
191.9958722
193.4032209
193.8872504
196.6839298
200.2820978
202.4436527
203.3359792
206.0089914
208.3801826
211.9892392
213.4281568
215.6158572
218.5677619
223.5281803
225.6290208
226.9552249
228.3963376
232.3351986
235.1469838
237.7551413
239.8066672
241.8172244
245.0819154
248.5363126
251.1286587
253.2888443
254.9691191
257.4986081
259.0821782
260.4954887
262.950853
265.6531567
270.595496
272.3238973
275.2370048
280.432178
284.3902003
287.2403794
289.770216
291.4223354
292.7571338
294.1801795
297.2235201
299.0003517
301.5751132
304.8408151
307.7539539
309.8256544
315.4067892
317.0603577
319.623418
322.8187027
324.7909927
327.0210087
330.92101
332.8768987
336.1816445
339.4841105
340.9555255
344.2749264
346.599918
349.11631
351.227291
355.5160812
358.4240069
360.9413193
365.0507537
366.9804125
369.0242198
371.4204592
374.1611449
376.1910951
378.3195752
381.3125166
383.9682508
386.4021993
389.0085425
390.0118973
393.2411833
394.8963228
396.6300957
398.5992054
400.8964026
401.7634849
403.714773
405.6403387
409.7740464
411.0912094
413.0010614
419.0154099
428.7555388
430.8854488
433.4436947];
%%
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.duration = [1.784652983
3.825376742
1.663920003
2.509028699
4.383323943
3.235643907
3.558688783
2.992232276
2.403683907
2.875987225
1.494893827
1.027327917
1.984932539
3.423208551
1.427843811
1.241354567
1.045986651
1.681481163
1.364282692
1.534406439
4.034012944
3.950869755
0.959278418
3.725030256
1.480157778
1.098670134
1.434527336
1.286430733
1.223793406
3.078310316
1.692456888
4.175491637
2.355466408
1.574549242
3.620043781
5.408337048
4.287835054
2.101568829
2.457910173
1.313794355
1.530016149
2.214890227
1.048181796
1.561845753
3.90239135
1.674895728
1.645261268
3.335523011
3.60504728
1.085499263
2.662960508
3.937883416
0.999888603
1.729752407
3.092665653
0.521346966
0.907496774
0.893424064
1.0800114
1.053669658
0.654153246
0.484029499
2.037159165
2.218194146
1.09318227
0.892326492
2.088941033
1.379648708
2.817728988
1.438917627
1.047529429
2.56336403
3.241468139
1.546566405
0.659260394
1.156841479
3.21411549
2.38043915
1.788749226
1.232573986
1.91726353
2.369180578
3.351225394
1.53440644
1.110743431
1.378551136
1.464161795
1.484505023
1.010572782
2.194872136
1.381532214
3.836179534
1.656932831
2.52345379
3.309198131
3.393323103
1.918246171
1.209788406
0.734496979
1.160963687
0.50735485
2.628572467
0.788275179
1.595575178
2.039026049
2.209887646
1.645264598
3.555004662
1.538228413
2.059701746
1.673050272
1.465219362
1.592242945
1.742570224
1.955888744
2.834612024
2.534761603
1.432905957
1.475974858
1.889893142
1.678019916
2.110980983
2.790833489
1.615437815
1.458591067
2.523029167
1.253125516
2.043807325
1.308806818
1.842389401
1.506967552
1.70067908
1.311905009
1.944159545
2.096993782
2.606343141
1.003354878
2.227876563
1.587089922
1.473648259
1.197538331
1.62879768
0.867082323
1.470551273
0.968134915
3.594799611
1.28752853
0.893499757
4.736524549
7.526640892
1.154646333
2.19933968
2.711080141];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.tmod = 0;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.name = 'emoDHOG';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.param = [1.733333334
1.809876543
2.466666667
2.598765433
2.355555555
2.62654321
2.584045584
3.277777778
2.845117845
2.69212963
2.740740741
2.067901235
2.417989418
2.58922559
2.782407408
2.656084656
3.283950617
3.148148148
3.296296296
3.604938272
2.941176471
3.640740741
3.052910053
3.864923747
4.118518518
3.222222222
2.597883598
2.948148148
3.066666667
3.533333333
2.222222222
2.300194931
2.111111111
2.148148148
2.416666666
2.416666666
2.324074074
2.316872428
2.300925926
3.027777778
3.53968254
3.148148148
2.320987654
2.518518519
2.098039216
3.555555556
2.62962963
2.402777777
2.280864197
2.333333333
2.296296296
2.524691358
2.555555556
2.592592593
2.603174604
2.037037037
3.345679012
3.898148148
2.822222222
3.296296296
3.962962963
3.851851852
3.722222223
3.860082305
4.296296296
4.518518519
4.641975309
4.938271605
5.153439153
4.392592593
4.601851852
5.022222222
5.104377104
4.032
4.133333333
4.32
4.428
4.537777778
4.56
3.72
4.222857143
4.52
4.4
4.52
3.56
3.76
3.888
4.828571429
4.96
4.933333333
4.88
3.384
3.466666667
3.874285714
3.903333333
2.748251748
3.091346154
2.971153846
3.615384615
3.230769231
3.653846154
4.115384615
4
3.796703297
3.269230769
3.52991453
3.629807692
3.17948718
2.653846154
2.83974359
3.340659341
3.307692308
3.423076923
3.438461538
3.5
3.679487179
3.634615385
4.012820513
4.032967033
2.55982906
2.461538462
2.794871795
2.722222222
3.205128205
3.884615385
3.328402367
2.653846154
2.711538462
2.675824176
3.647435897
4.076923077
4.564102564
4.634615385
3.653846154
4.038461538
3.698717949
3.630769231
3.679487179
2.232804233
2.338624338
2.34074074
2.481481481
2.666666667
2.518518519
2.601851852
2.991452991
2.481481481
2.481481481
2.701388889
3.434074074
3.740740741
4.037037037
4.208754209];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.poly = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.orth = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).multi = {''};
matlabbatch{1}.spm.stats.fmri_spec.sess(1).regress = struct('name', {}, 'val', {});
matlabbatch{1}.spm.stats.fmri_spec.sess(1).multi_reg = {[inDirNII '/MH1st_run1/rp_S' num2str(i, '%02.f') '_0006.txt']};
matlabbatch{1}.spm.stats.fmri_spec.sess(1).hpf = 512;
%%
DMniiList = spm_select('FPList', [inDirNII '/DM3rd_run2/'], '\.nii*');
sess2_scans = spm_select('Expand', DMniiList);
matlabbatch{1}.spm.stats.fmri_spec.sess(2).scans = cellstr(sess2_scans);
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.name = 'DM2V';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.onset = [3.119262056
7.73515194
10.79030439
12.94803396
15.68506392
19.89851352
23.25732405
24.89334834
29.22916081
31.82809282
35.17959009
36.97758772
39.44947274
40.53606957
41.43990389
45.46484288
46.95231437
48.66533132
52.84237671
56.1159461
58.42805313
60.32985255
62.68503656
63.65090042
65.48217257
67.38827562
69.85174979
73.02717882
75.41044331
77.45291678
79.24395946
82.38416808
84.39023712
86.19106009
88.10246625
91.39624858
93.64890193
94.90781766
97.21140433
100.4970468
104.3941243
106.2799168
107.1107792
109.4000108
111.4710211
113.0716292
115.4405494
116.5891312
118.8883497
120.8976134
122.3100802
124.4570078
127.4050548
129.1187131
131.5651802
134.2044505
136.6560362
140.266832
142.5121718
145.2125369
149.0310456
151.634096
152.4408119
154.533502
158.0141321
159.9038692
162.8463305
166.5348692
169.2074472
171.3031365
175.7043583
178.5109158
179.8422713
182.3661008
185.5140905
188.4896731
194.8732738
197.1394783
198.7866301
202.2254768
204.0355368
206.1574921
208.1456305
209.6734515
211.8611518
215.2510637
217.2312474
221.3046648
222.0883316
223.6653474
225.5284602
227.4341066
229.7454634
231.4149469
233.1654663
236.363488
237.7343561
240.7104721
242.3974411
244.3375465
245.3593866
248.792093
251.6814251
253.1390015
254.9554509
257.1611899
259.08155
262.1925918
265.1851826
268.0428808
268.7390999
270.7199136
272.0337079
273.799854
274.8392552
277.5048563
280.729035
283.2159274
285.3996185
287.8167339
290.7701707
292.0982335
294.6436556
296.8931029
298.202311
299.5969453
300.3608558
302.6419477
303.9765959
307.4291456
310.2536452
312.9297766
315.8147943
318.5559541
320.0230281
323.566872
328.5114792
330.9527303
334.154501
336.1506917
338.9928282
342.1453929
344.4062836
345.4325139
347.7537489
350.1918918
350.9064115
352.5051942
354.3662856
356.2994582
358.4008311
362.0511395
363.8903775
366.2609385
369.6958401
371.7050169
375.7384648
378.276313
380.8027072
383.4305563
386.7548747
389.5642798
392.9221665
394.9730513
400.4467751
402.9600093
404.9887686
410.6048942
413.22706
414.2741442
416.743921
419.9035276];
%%
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.duration = [3.306409902
2.11153365
1.742847135
1.990996624
2.825683645
2.526046787
1.636024281
2.503257985
1.212817679
1.759408816
1.725557849
1.499273144
0.662933827
0.903834317
2.391132027
1.185378366
0.695861003
1.696292906
2.482698157
1.256720582
1.317087073
1.5519676
0.520249393
0.840827473
1.784272493
1.150256044
1.847757694
1.771482112
1.698216402
1.791042687
1.758115286
1.551967601
0.679397415
1.536601585
2.044581947
1.408185594
1.258915727
1.222412983
2.185266968
2.525318506
0.870375042
0.327076623
1.470551498
1.049279368
0.853911452
1.893671207
0.640786418
1.926239845
1.955678346
0.759520212
1.85058303
1.223880297
1.187573511
1.905472632
1.184280793
1.233671558
2.688943707
1.193061374
1.12281673
2.708243832
1.689978894
0.689275568
1.937932427
2.012209045
1.889737101
1.375062685
2.561995032
2.503551812
1.141736138
2.510148447
1.990344261
1.249037575
1.330518393
1.715505913
1.6127793
2.582664152
1.62851483
0.870364066
2.368365853
0.716714881
1.402697732
1.0800114
1.223793405
1.575733482
2.340144916
1.339038524
1.454283643
0.750739632
1.05237613
1.611768619
0.890391796
1.260545624
1.093182271
0.66842169
1.384038999
0.516956676
1.967947601
0.655250818
0.95496382
1.021840054
2.556137429
1.701237469
0.568542586
1.231095922
1.58599235
1.351198488
1.515747707
1.128304593
2.268301768
0.696219095
0.912528231
0.493907653
1.163687589
1.039401216
1.495980427
2.345773012
2.041658745
1.287452614
2.12406358
0.853259312
0.513663959
1.821676627
1.359425021
1.232573986
1.020742482
0.714519738
0.997323717
0.594884328
2.181767318
1.772579685
1.281116653
2.138961988
1.854897628
1.196354092
1.72280843
2.464495606
1.35879483
2.313030818
1.491601111
1.74843309
1.62440739
0.992205595
0.651958101
0.927894246
1.396112297
0.567445014
0.901824154
1.136617567
1.520137996
1.047084224
2.802634848
0.868179896
1.764700945
2.092679182
1.576472287
2.820196009
2.07906288
1.141736138
2.007720662
2.198687536
1.839150894
2.66589491
1.247940002
2.579284543
1.679286018
1.701682677
2.953556561
1.103060422
0.992205594
0.691470712
2.263183646
3.660925615];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.tmod = 0;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.name = 'emoDM2V';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.param = [2.251851852
2.133333333
2.180555555
2.481481481
2.296296296
2.888888889
3.005291005
3.144032922
3.907407408
3.814814815
4.577777778
4.576719577
3.37037037
3.666666667
3.841269841
3.481481481
3.555555556
4.481481481
3.875420876
4.777777778
4.938271605
4.907407408
4.481481481
4.685185186
4.027777778
4.24691358
3.846560847
4.082417582
3.994505494
3.94017094
4.254807693
4.049450549
4.115384615
3.707692308
3.598901099
3.121794872
2.91025641
2.915384615
3.247252747
3.273504273
4.115384615
4.557692308
4.538461538
3.615384615
3.461538462
3.434065934
3.961538462
3.269230769
2.919230769
2.923076923
3.269230769
3.5
3.884615385
3.351648351
3.923076923
3.423076923
3.13076923
3.230769231
2.346153846
2.094674556
3.230769231
2.423076923
2.455128206
2.461538462
2.269230769
3.269230769
3.041666667
2.269230769
2.307692308
2.173076923
3.634615385
3.807692308
3.461538462
3.269230769
3.623076923
3.879120879
3.872
2.94
4.097142857
4.36
3.32
3.24
4.816
4.794285714
3.632
4.848
4.705
3.4
3.44
3.36
3.12
2.92
3.04
4.04
3.251428571
3.08
4.493333333
4.48
3.786666667
3.76
3.785454545
3.96
2.296296296
3
2.62962963
2.948148148
2.87654321
3.842592593
3.814814815
4.185185185
4.259259259
2.37037037
2.666666667
2.62962963
3.433862433
3.5
3.429629629
3.592592593
3.773148148
3.185185185
2.333333333
2.666666667
2.592592593
2.518518519
3.925925926
3.37037037
3.555555556
1.888888889
2.082304527
2.296296296
3.555555556
2.613756614
3.026455026
2.765432099
2.814814815
2.987654321
2.62962963
2.617283951
2.222222222
2.52910053
2.296296296
2.543209877
2.592592593
2.638888889
2.333333333
2.555555556
3.037037037
3.148148148
3.251851852
3.074074074
3.121693122
2.444444444
3.555555556
3.837037037
3.133333333
3.055555556
3.277777778
3.407407407
3.967078189
3.953703704
3.720164609
3.592592593
3.787037037
3.063973064
3.820987655
4.037037037
3.860082305
3.296296296
3.148148148
3.148148148
3.403292181
3.955026455];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.poly = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.orth = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).multi = {''};
matlabbatch{1}.spm.stats.fmri_spec.sess(2).regress = struct('name', {}, 'val', {});
matlabbatch{1}.spm.stats.fmri_spec.sess(2).multi_reg = {[inDirNII '/DM3rd_run2/rp_S' num2str(i, '%02.f') '_0006.txt']};
matlabbatch{1}.spm.stats.fmri_spec.sess(2).hpf = 512;
matlabbatch{1}.spm.stats.fmri_spec.fact = struct('name', {}, 'levels', {});
matlabbatch{1}.spm.stats.fmri_spec.bases.hrf.derivs = [0 0];
matlabbatch{1}.spm.stats.fmri_spec.volt = 1;
matlabbatch{1}.spm.stats.fmri_spec.global = 'None';
matlabbatch{1}.spm.stats.fmri_spec.mthresh = 0.8;
matlabbatch{1}.spm.stats.fmri_spec.mask = {''};
matlabbatch{1}.spm.stats.fmri_spec.cvi = 'AR(1)';
matlabbatch{2}.spm.stats.fmri_est.spmmat(1) = cfg_dep('fMRI model specification: SPM.mat File', substruct('.','val', '{}',{1}, '.','val', '{}',{1}, '.','val', '{}',{1}), substruct('.','spmmat'));
matlabbatch{2}.spm.stats.fmri_est.write_residuals = 0;
matlabbatch{2}.spm.stats.fmri_est.method.Classical = 1;
matlabbatch{3}.spm.stats.con.spmmat(1) = cfg_dep('Model estimation: SPM.mat File', substruct('.','val', '{}',{2}, '.','val', '{}',{1}, '.','val', '{}',{1}), substruct('.','spmmat'));
matlabbatch{3}.spm.stats.con.consess{1}.tcon.name = 'EmoParaModT >';
matlabbatch{3}.spm.stats.con.consess{1}.tcon.weights = [0 1];
matlabbatch{3}.spm.stats.con.consess{1}.tcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{2}.fcon.name = 'EmoParaModF >';
matlabbatch{3}.spm.stats.con.consess{2}.fcon.weights = [0 1];
matlabbatch{3}.spm.stats.con.consess{2}.fcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{3}.tcon.name = 'EmoWordOnsetT >';
matlabbatch{3}.spm.stats.con.consess{3}.tcon.weights = [1 0];
matlabbatch{3}.spm.stats.con.consess{3}.tcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{4}.fcon.name = 'EmoWordOnsetF >';
matlabbatch{3}.spm.stats.con.consess{4}.fcon.weights = [1 0];
matlabbatch{3}.spm.stats.con.consess{4}.fcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.delete = 1;


spm_jobman('run',matlabbatch);
    
     end
end

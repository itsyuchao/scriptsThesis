%-----------------------------------------------------------------------
% Job saved on 02-Oct-2019 17:59:16 by cfg_util (rev $Rev: 7345 $)
% spm SPM - SPM12 (7487)
% cfg_basicio BasicIO - Unknown
% Modified by Yuchao Wang 11/8/2019
%-----------------------------------------------------------------------

rootDir = '/Users/yuchaow/Documents/narrativefMRIdata';

%%Prep output directory 
for i = 1:60 
    spm_mkdir([rootDir '/S' num2str(i, '%02.f') '/SPMemoOutputs512Event']);
end

%%BATCH RUN
for i = 1:60 
    outDirSPM = [rootDir '/S' num2str(i, '%02.f') '/SPMemoOutputs512Event'];
    inDirNII = [rootDir '/S' num2str(i, '%02.f') '/session1'];
     if mod(i,2) == 1 
         continue 
     elseif ~exist(inDirNII, 'dir') 
         ['OOPS, NO NIFTI FILES FOR SUBJECT #' num2str(i)]
         continue
     else
         
matlabbatch{1}.spm.stats.fmri_spec.dir = {outDirSPM};
matlabbatch{1}.spm.stats.fmri_spec.timing.units = 'secs';
matlabbatch{1}.spm.stats.fmri_spec.timing.RT = 0.88;
matlabbatch{1}.spm.stats.fmri_spec.timing.fmri_t = 16;
matlabbatch{1}.spm.stats.fmri_spec.timing.fmri_t0 = 8;
%%
DMniiList = spm_select('FPList', [inDirNII '/DM1st_run1/'], '\.nii*');
sess1_scans = spm_select('Expand', DMniiList);
matlabbatch{1}.spm.stats.fmri_spec.sess(1).scans = cellstr(sess1_scans);
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.name = 'DMOG';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.onset = [3.233224844
8.131277768
10.8714381
13.3528537
16.4098208
20.23116602
23.71373083
25.20211514
28.93172044
31.31937522
34.39446851
36.1734379
39.21038825
40.86651618
41.69079317
45.60167151
47.26449394
49.05615584
52.57978702
56.0671983
58.52774905
60.4855249
62.01883377
63.18490126
65.25141226
67.65223768
69.47894577
72.36358194
74.73353327
77.24478804
79.05439317
82.51549377
84.82352324
86.65907488
88.81869476
92.17972396
94.63138189
96.09499842
98.24642638
101.402092
104.6191462
106.8436775
107.611432
109.8587181
111.4162108
113.0888533
115.1952248
116.5717573
119.0356133
121.1660927
122.9352708
125.7154027
128.6245231
130.1968438
132.9035706
135.2080614
137.1612481
140.8001773
142.8509995
145.1655698
149.2985354
151.8694167
152.6560571
155.4581059
158.3247367
160.6490717
164.0548202
167.3565984
170.1042569
171.8339647
175.8832032
178.8593231
180.4033699
182.6112804
185.6128751
188.4282116
192.9838916
195.2668186
197.0277058
199.7868078
201.8195881
204.1371414
206.4718934
208.1891133
210.4127433
213.8256083
216.5486041
220.4054366
221.5291179
223.2322634
224.9235466
226.9412658
229.235848
230.5837357
232.0787342
234.6598947
236.1014928
238.8858173
240.4515123
242.1740149
243.1655928
246.4537925
249.2898347
251.0158923
252.7776763
254.9551563
257.3951417
260.5897179
262.3575072
265.5973701
266.6800101
268.9002264
270.1907745
272.0679134
273.6556246
275.7082179
279.1224983
281.9820463
284.0063353
286.0328277
288.1858372
289.5022048
291.9800546
294.5855875
296.1294592
296.8398975
298.8065086
300.8279353
302.1641159
305.3934129
308.1963199
311.1089223
313.5140011
315.8668374
317.7110484
320.6342811
324.4564569
326.8631679
329.9682399
331.6452706
334.6058614
336.9683872
338.8373484
339.9907492
342.6110613
344.9795938
346.2221532
347.0778841
348.9994898
351.0142503
353.0647048
356.7602353
357.7041842
360.4026787
363.4539725
365.7936053
370.0161267
372.5526917
375.0712048
377.7005468
381.0280567
383.8345148
387.1946712
389.2394647
394.5092778
397.0033864
398.8582919
404.284406
407.1354625
408.2393308
410.5575104
413.9848734];
%%
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.duration = [3.686539524
2.219650259
1.828359928
2.116369373
2.552942802
2.62538259
1.488384311
2.454617454
1.318184645
2.300044481
1.778969387
1.531743912
1.016352192
0.824276993
2.60406088
1.245744856
0.7799936
2.000320506
2.857882991
1.467454514
1.39281958
1.533308868
1.166067492
0.981946726
1.968947307
1.119524012
1.846660122
1.610262814
1.947447511
1.697803087
1.972874482
1.596112682
0.720344823
1.808740204
2.010801652
1.584255702
1.463616527
1.194694106
2.398523854
2.464865966
0.860435468
0.709730704
1.467799773
1.160083724
0.966214878
1.878964167
0.757848039
2.055300582
2.056763161
0.773540404
2.419722014
1.17601332
1.286887137
2.015000608
1.177238442
1.240216444
3.038280354
1.423472072
1.133194849
3.027650073
1.589381313
0.786640468
2.112068104
1.920338019
2.289662192
1.255263828
2.62047752
2.605665346
0.983653029
2.564913371
2.095164081
1.10294074
1.172459792
1.684012699
1.743970402
2.230946902
1.641994542
0.777637827
2.240892057
0.938288049
1.36674462
1.231776297
1.361437562
1.556870444
2.477584268
1.797259587
1.869089758
0.822240356
1.136544521
1.691283241
0.90746786
1.442041781
1.204702416
0.632955249
1.303413714
0.56750152
1.9756412
0.651256524
0.996311895
0.991577835
2.412404503
1.799564462
0.598636266
1.170383433
1.684106754
1.541169963
1.377004934
1.146324766
2.414293882
0.679303565
0.826421801
0.566086304
1.343039755
1.058581389
1.480315684
2.350577073
1.927459437
1.337033058
2.026492439
1.044365029
0.597221051
1.925698611
1.323226736
1.224507242
0.710438311
1.140663902
1.059996605
0.584484109
2.23135289
1.953247054
1.2361106
2.025800993
1.582806135
1.273694183
1.9904206
2.277677074
1.487391765
2.348470187
1.640235067
2.093980432
1.525602589
1.311905009
1.078394409
0.959106248
1.47182439
0.592975403
0.855730844
1.256269456
1.468993959
1.143494333
2.744352664
0.874603339
1.761943621
1.915100656
1.746657431
3.00009668
2.060111782
1.193026886
2.013852027
2.08476559
1.845441351
2.832441652
1.265202889
2.585157054
1.737884953
1.854905497
3.348239531
1.43502878
1.050090095
1.076882664
2.308498311
4.17428317];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.tmod = 0;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.name = 'emoDMOG';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.param = [2.206790123
2.12345679
2.180555555
2.472222222
2.296296296
2.925925926
3.005291005
3.144032922
3.851851852
3.814814815
4.577777778
4.576719577
3.37037037
3.666666667
3.861111111
3.481481481
3.555555556
4.477777778
3.875420876
4.777777778
4.931216931
4.907407408
4.488888889
4.681481482
4.024691358
4.24691358
3.846560847
4.082417582
3.994505494
3.94017094
4.247863248
4.038461539
4.115384615
3.705128205
3.604395604
3.121794872
2.91025641
2.915384615
3.254807692
3.273076923
4.115384615
4.596153846
4.538461538
3.615384615
3.461538462
3.434065934
3.961538462
3.269230769
2.919230769
2.923076923
3.269230769
3.5
3.884615385
3.351648351
3.923076923
3.423076923
3.126373626
3.230769231
2.346153846
2.097435897
3.230769231
2.423076923
2.456043956
2.461538462
2.269230769
3.269230769
3.046703297
2.269230769
2.307692308
2.173076923
3.628205128
3.807692308
3.461538462
3.269230769
3.621794872
3.876068376
3.88
2.94
4.095
4.36
3.32
3.24
4.816
4.794285714
3.629090909
4.846666667
4.706666667
3.4
3.44
3.36
3.12
2.92
3.04
4.04
3.251428571
3.08
4.493333333
4.48
3.78
3.76
3.785454545
3.96
2.296296296
3
2.62962963
2.948148148
2.87654321
3.842592593
3.814814815
4.185185185
4.259259259
2.37037037
2.666666667
2.62962963
3.432098765
3.501683502
3.429629629
3.592592593
3.773148148
3.185185185
2.333333333
2.666666667
2.592592593
2.518518519
3.925925926
3.509259259
3.555555556
1.888888889
2.082304527
2.291005291
3.555555556
2.613756614
3.018518519
2.761904762
2.814814815
2.981481482
2.62962963
2.617283951
2.222222222
2.52910053
2.296296296
2.533333334
2.601851852
2.638888889
2.333333333
2.555555556
3.037037037
3.148148148
3.251851852
3.074074074
3.12037037
2.444444444
3.588477366
3.837037037
3.135802469
3.055555556
3.277777778
3.407407407
3.967078189
3.94949495
3.720164609
3.592592593
3.787037037
3.063973064
3.82010582
4.014814815
3.862962963
3.296296296
3.148148148
3.148148148
3.403703703
3.951388889];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.pmod.poly = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).cond.orth = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(1).multi = {''};
matlabbatch{1}.spm.stats.fmri_spec.sess(1).regress = struct('name', {}, 'val', {});
matlabbatch{1}.spm.stats.fmri_spec.sess(1).multi_reg = {[inDirNII '/DM1st_run1/rp_S' num2str(i, '%02.f') '_0006.txt']};
matlabbatch{1}.spm.stats.fmri_spec.sess(1).hpf = 512;
%%
DHniiList = spm_select('FPList', [inDirNII '/MH3rd_run2/'], '\.nii*');
sess2_scans = spm_select('Expand', DHniiList);
matlabbatch{1}.spm.stats.fmri_spec.sess(2).scans = cellstr(sess2_scans);
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.name = 'DH2V';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.onset = [4.058168356
6.007944228
10.60169723
12.75735148
16.13691028
22.00049211
26.20189087
31.68265221
36.12069613
40.16153894
44.2788627
46.7427116
48.38547092
50.84858607
54.43772572
55.97615525
58.2148092
59.93747962
62.10168321
64.47913643
67.18567049
72.87661039
78.74754201
79.9037702
84.3923063
87.29763668
89.8979127
91.35085118
93.86191593
95.41739246
99.88193667
102.9068012
108.9190232
111.564775
113.8465672
118.7404096
125.6025595
132.2192423
135.3616955
138.6919555
140.7415055
143.4673222
147.0046548
148.513495
150.168933
155.5990481
158.1851953
160.2151728
165.0383695
169.4834774
170.6032056
174.341997
178.6180004
179.9814548
181.6707137
186.440483
187.9891848
189.5850006
191.3880256
193.3411804
194.9520128
196.4742315
197.9262484
199.6576384
202.6012435
204.469914
205.3847708
208.0215642
210.3490878
214.516188
215.9950298
218.1778839
220.7490486
226.2305264
228.2218195
229.658069
231.1274914
235.4565973
238.2235041
240.7163105
243.2334332
246.0006128
249.3008405
253.3409325
256.1238456
258.7250089
259.8200112
263.2386979
264.8376367
265.9448225
268.3122761
271.1019293
276.1632555
277.9822015
280.9590816
285.7144319
290.2830156
292.5640738
294.6520349
296.0672959
297.8370459
299.3485139
302.2798159
303.868533
305.978865
309.2365688
312.1746113
314.6768714
320.8509806
323.0109182
325.5683633
328.9287754
331.1913067
332.9785131
335.7407006
338.0581105
341.010917
343.83057
345.2798978
348.3717156
350.7780287
353.3547376
355.3733471
359.5789184
361.825812
363.8885961
368.0987422
370.0016394
372.0528068
374.6827423
377.1442058
379.1539369
381.3695442
384.8202794
388.0553468
390.7644921
393.4617599
394.8596
398.7402896
400.9742083
402.4603975
404.5440135
407.2478556
408.3607941
409.6085382
411.4152073
414.8911972
416.6404231
419.0267084
424.7696089
433.9334254
436.1707128
438.803865];
%%
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.duration = [1.696510987
3.783448181
1.680180887
2.461954799
4.284761902
3.437576489
3.547264676
2.841255272
2.323616278
2.667687458
1.662519562
1.17388952
1.85515599
3.237858677
1.464251955
1.260557761
0.994921409
1.578769032
1.293986542
1.620132376
4.312383797
3.96581228
0.986679456
3.79698022
1.522218181
0.985502035
1.452938483
1.199024442
1.096179683
3.165609133
1.702688182
4.585135914
2.103591987
1.730059194
3.517658248
5.329983159
4.378797016
2.19232521
2.632970594
1.251599358
1.442341688
1.982009928
1.084405464
1.585970068
3.937519777
1.575390348
1.654277609
3.590078227
3.552980901
1.119728118
2.591044605
3.748859732
0.953711646
1.689258942
3.148220814
0.41562989
0.871292121
0.899550244
1.135034601
1.038486015
0.657001355
0.423871843
1.731389972
1.720161771
1.099711948
0.69232401
1.796574986
1.169879432
2.631059643
1.478841764
0.979580545
2.089599203
2.964542792
1.606003316
0.77870239
1.205679909
2.840145371
2.453712623
1.937251048
1.197437956
2.342011133
2.44668247
3.648334763
1.385825443
1.103244213
1.417598753
1.698541814
1.573035507
0.960008043
1.875291361
1.300573251
3.947434276
1.818946
2.36835808
3.102164863
3.369132442
1.530648321
1.116195853
0.777098378
1.070242023
0.651114248
2.797075891
0.886581302
1.53535801
2.237817843
2.381463302
1.796728567
3.62024775
1.62955175
1.898567012
1.567193469
1.575016626
1.787206446
1.72537309
2.048243956
2.563918303
2.207207446
1.37688809
1.463422765
1.691261225
1.683676309
2.018609497
2.546357142
1.253427863
1.390624435
2.435773962
1.219403116
1.992996039
1.367748969
1.776230944
1.616724382
1.864949564
1.219403115
1.887824805
2.092874915
2.67092614
1.018079955
1.921186214
1.499642658
1.121795074
1.015058886
1.490590204
1.065742957
1.147864939
0.919667939
3.134644831
1.073230007
0.878058048
4.096216488
7.053869741
1.108548287
1.861558755
2.781769993];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.tmod = 0;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.name = 'emoDH2V';
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.param = [1.733333334
1.806267806
2.466666667
2.598765433
2.355555555
2.62654321
2.584045584
3.277777778
2.864197531
2.674603175
2.736111111
2.067901235
2.438271605
2.58922559
2.767195767
2.656084656
3.283950617
3.154320988
3.290123457
3.604938272
2.941176471
3.640740741
3.055555556
3.864923747
4.118518518
3.318518519
2.597883598
2.962962963
3.092592593
3.533333333
2.222222222
2.300194931
2.111111111
2.148148148
2.421652421
2.415204678
2.324074074
2.328703703
2.300411522
3.027777778
3.543209877
3.148148148
2.320987654
2.518518519
2.098039216
3.555555556
2.62962963
2.402777777
2.280864197
2.333333333
2.296296296
2.524691358
2.555555556
2.592592593
2.603174604
2.037037037
3.345679012
3.898148148
2.822222222
3.296296296
3.962962963
3.851851852
3.703703704
3.851851852
4.296296296
4.518518519
4.650793651
4.940740741
5.154882155
4.425925926
4.604938272
5.026455026
5.103703704
4.032
4.133333333
4.32
4.426666667
4.555
4.56
3.72
4.24
4.52
4.4
4.52
3.56
3.744
3.888
4.846666667
4.96
4.931428571
4.88
3.384
3.466666667
3.906666667
3.908
2.746153846
3.083333333
3.102564102
3.615384615
3.230769231
3.653846154
4.129807692
4
3.788461539
3.269230769
3.52991453
3.637362637
3.184615385
2.653846154
2.838461538
3.33974359
3.307692308
3.423076923
3.438461538
3.5
3.679487179
3.641025641
4.023076923
4.032967033
2.576923077
2.461538462
2.794871795
2.722222222
3.261538461
3.938461538
3.338461539
2.653846154
2.70979021
2.673076923
3.669230769
4.076923077
4.564102564
4.653846154
3.653846154
4.038461538
3.738461538
3.625
3.679487179
2.259259259
2.34074074
2.342592592
2.481481481
2.666666667
2.518518519
2.601851852
2.991452991
2.481481481
2.481481481
2.703703704
3.444444444
3.740740741
4.037037037
4.218518518];
%%
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.pmod.poly = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).cond.orth = 1;
matlabbatch{1}.spm.stats.fmri_spec.sess(2).multi = {''};
matlabbatch{1}.spm.stats.fmri_spec.sess(2).regress = struct('name', {}, 'val', {});
matlabbatch{1}.spm.stats.fmri_spec.sess(2).multi_reg = {[inDirNII '/MH3rd_run2/rp_S' num2str(i, '%02.f') '_0006.txt']};
matlabbatch{1}.spm.stats.fmri_spec.sess(2).hpf = 512;
matlabbatch{1}.spm.stats.fmri_spec.fact = struct('name', {}, 'levels', {});
matlabbatch{1}.spm.stats.fmri_spec.bases.hrf.derivs = [0 0];
matlabbatch{1}.spm.stats.fmri_spec.volt = 1;
matlabbatch{1}.spm.stats.fmri_spec.global = 'None';
matlabbatch{1}.spm.stats.fmri_spec.mthresh = 0.8;
matlabbatch{1}.spm.stats.fmri_spec.mask = {''};
matlabbatch{1}.spm.stats.fmri_spec.cvi = 'AR(1)';
matlabbatch{2}.spm.stats.fmri_est.spmmat(1) = cfg_dep('fMRI model specification: SPM.mat File', substruct('.','val', '{}',{1}, '.','val', '{}',{1}, '.','val', '{}',{1}), substruct('.','spmmat'));
matlabbatch{2}.spm.stats.fmri_est.write_residuals = 0;
matlabbatch{2}.spm.stats.fmri_est.method.Classical = 1;
matlabbatch{3}.spm.stats.con.spmmat(1) = cfg_dep('Model estimation: SPM.mat File', substruct('.','val', '{}',{2}, '.','val', '{}',{1}, '.','val', '{}',{1}), substruct('.','spmmat'));
matlabbatch{3}.spm.stats.con.consess{1}.tcon.name = 'EmoParaModT >';
matlabbatch{3}.spm.stats.con.consess{1}.tcon.weights = [0 1];
matlabbatch{3}.spm.stats.con.consess{1}.tcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{2}.fcon.name = 'EmoParaModF >';
matlabbatch{3}.spm.stats.con.consess{2}.fcon.weights = [0 1];
matlabbatch{3}.spm.stats.con.consess{2}.fcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{3}.tcon.name = 'EmoWordOnsetT >';
matlabbatch{3}.spm.stats.con.consess{3}.tcon.weights = [1 0];
matlabbatch{3}.spm.stats.con.consess{3}.tcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.consess{4}.fcon.name = 'EmoWordOnsetF >';
matlabbatch{3}.spm.stats.con.consess{4}.fcon.weights = [1 0];
matlabbatch{3}.spm.stats.con.consess{4}.fcon.sessrep = 'repl';
matlabbatch{3}.spm.stats.con.delete = 1;


spm_jobman('run',matlabbatch);
    
     end
end
